function IterarCamposEdit(t, n) {
  function i(t) {
    if (null == colsEdi) return !0;
    for (var n = 0; n < colsEdi.length; n++) if (t == colsEdi[n]) return !0;
    return !1;
  }
  var a = 0;
  t.each(function () {
    a++, "buttons" != $(this).attr("name") && i(a - 1) && n($(this));
  });
}
function FijModoNormal(t) {
  $(t).parent().find("#bAcep").hide(),
    $(t).parent().find("#bCanc").hide(),
    $(t).parent().find("#bEdit").show(),
    $(t).parent().find("#bElim").show();
  var n = $(t).parents("tr");
  n.attr("id", "");
}
function FijModoEdit(t) {
  $(t).parent().find("#bAcep").show(),
    $(t).parent().find("#bCanc").show(),
    $(t).parent().find("#bEdit").hide(),
    $(t).parent().find("#bElim").hide();
  var n = $(t).parents("tr");
  n.attr("class", "editing");
}
function ModoEdicion(t) {
  return "editing" == t.attr("class");
}
function rowAcep(t) {
  var n = $(t).parents("tr"),
    i = n.find("td");
  ModoEdicion(n) &&
    (IterarCamposEdit(i, function (t) {
      if (t.find("div[class='img-address']").length > 0)
        t.find("input").val()
          ? t.html(
              "<img src='" +
                t.find("div[class='img-address']").html() +
                "' width='40px'/>"
            )
          : t.html(
              "<img src='" +
                t.find("div[class='img-address']").html() +
                "'width='40px'/>"
            );
      else {
        var n = t.find("input").val();
        t.html(n);
      }
    }),
    n.removeClass("editing"),
    FijModoNormal(t),
    params.onEdit(n));
}
function rowCancel(t) {
  var n = $(t).parents("tr"),
    i = n.find("td");
  ModoEdicion(n) &&
    (IterarCamposEdit(i, function (t) {
      if (t.find("div[class='img-address']").length > 0)
        t.html(
          "<img src='" +
            t.find("div[class='img-address']").html() +
            "'width='40px'/> "
        );
      else {
        var n = t.find("div").html();
        t.html(n);
      }
    }),
    FijModoNormal(t));
}
function rowEdit(t) {
  var n = $(t).parents("tr"),
    i = n.find("td");
  ModoEdicion(n) ||
    (IterarCamposEdit(i, function (t) {
      var n = t.html();
      if (-1 != n.search("img")) {
        var i = n.split("src=")[1].split('"')[1],
          a = '<div style="display: none;" class="img-address">' + i + "</div>",
          d =
            '<input class="form-control input-sm" id="img-input"  value="' +
            i +
            '" type="file" accept="image/*" onchange="imageChange(event)"/>';
        t.html(a + d);
      } else {
        (a = '<div style="display: none;">' + n + "</div>"),
          (d =
            '<input class="form-control input-sm" maxlength="20"  value="' +
            n +
            '">');
        t.hasClass("opinion") &&
          (d =
            '<input class="form-control input-sm" maxlength="100"  value="' +
            n +
            '">'),
          t.html(a + d);
      }
    }),
    FijModoEdit(t));
}
function rowElim(t) {
  var n = $(t).parents("tr");
  params.onBeforeDelete(n), params.onDelete();
}
function rowAddNew(t) {
  var n = $("#" + t),
    i = (params.imageColumn, n.find("tbody tr"), n.find("thead tr")),
    a =
      (i.find("th"),
      `<tr>\n        <td><img src="" alt="" width="40px"></td>\n        <td></td>\n        <td class="opinion"></td>\n        <td name='buttons'>${newColHtml}</td>\n    </tr>`);
  n.find("tbody").append(a);
  var d = n.find("tr:last");
  d.find("#bEdit").click(), params.onAdd();
}
function TableToCSV(t, n) {
  var i = "",
    a = "",
    d = $("#" + t);
  return (
    d.find("tbody tr").each(function () {
      ModoEdicion($(this)) && $(this).find("#bAcep").click();
      var t = $(this).find("td");
      (i = ""),
        t.each(function () {
          "buttons" == $(this).attr("name") || (i = i + $(this).html() + n);
        }),
        "" != i && (i = i.substr(0, i.length - n.length)),
        (a = a + i + "\n");
    }),
    a
  );
}
function imageChange(t) {
  var n = t.target.files[0];
  pixelarity.open(
    n,
    !0,
    function (n) {
      var i = $(t.target).parents("td"),
        a = i.parent("tr");
      a.attr("image-updated", !0), i.find("div[class='img-address']").html(n);
    },
    "jpg",
    0.7
  ) || alert("Whoops! That is not an image!");
}
var params = null,
  colsEdi = null,
  imageColumn = !1,
  imageColumnHtml = "<img src='' width='40px'/>",
  newColHtml =
    '<div class="btn-group pull-right"><button id="bEdit" type="button" class="btn btn-sm btn-default" onclick="rowEdit(this);"><span class="bi bi-pencil" > </span></button><button id="bElim" type="button" class="btn btn-sm btn-default" onclick="rowElim(this);"><span class="bi bi-trash" > </span></button><button id="bAcep" type="button" class="btn btn-sm btn-default btn-accept" style="display:none;" onclick="rowAcep(this);"><span class="bi bi-check" > </span></button><button id="bCanc" type="button" class="btn btn-sm btn-default" style="display:none;" onclick="rowCancel(this);"><span class="bi bi-x" > </span></button></div>',
  colEdicHtml = '<td name="buttons">' + newColHtml + "</td>";
$.fn.OpinionEdit = function (t) {
  var n = {
    columnsEd: null,
    $addButton: null,
    imageColumn: !1,
    onEdit: function () {},
    onBeforeDelete: function () {},
    onDelete: function () {},
    onAdd: function () {},
  };
  (params = $.extend(n, t)),
    this.find("thead tr").append('<th name="buttons"></th>'),
    this.find("tbody tr").append(colEdicHtml);
  var i = this;
  null != params.$addButton &&
    params.$addButton.click(function () {
      rowAddNew(i.attr("id"));
    }),
    null != params.columnsEd && (colsEdi = params.columnsEd.split(","));
};
